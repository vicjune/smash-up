<div class="menu" [ngClass]="{ active: menuOpen }">
  <button class="menu__button" (click)="menuOpen = !menuOpen">
    <i class="icon-menu"></i>
  </button>

  <div class="menu__wrapper">
    <button class="menu__wrapper__fullscreen" (click)="toggleFullscreen()">
      <i [class]="(fullscreen$ | async) ? 'icon-shrink2' : 'icon-enlarge2'"></i>
    </button>

    <div class="menu__wrapper__i18n">
      <button
        class="menu__wrapper__i18n__button"
        [disabled]="(language$ | async) === 'en' || !(language$ | async)"
        (click)="setLanguage('en')"
      >
        EN
      </button>
      <button
        class="menu__wrapper__i18n__button"
        [disabled]="(language$ | async) === 'fr'"
        (click)="setLanguage('fr')"
      >
        FR
      </button>
    </div>

    <div class="menu__wrapper__buttons">
      <button class="menu__wrapper__button" (click)="resetClicked()">
        <i class="icon-reload"></i>
        <span>{{ "RESET_GAME" | translate }}</span>
      </button>

      <button
        class="menu__wrapper__button"
        (click)="timerService.reset()"
        *ngIf="(timer$ | async)?.type === TimerType.BY_PLAYER"
      >
        <i class="icon-stopwatch"></i>
        <span>{{ "TIMER_BY_PLAYER_RESET" | translate }}</span>
      </button>

      <button class="menu__wrapper__button" (click)="settingsClicked()">
        <i class="icon-settings"></i>
        <span>{{ "SETTINGS" | translate }}</span>
      </button>
    </div>

    <button
      [class]="
        'menu__wrapper__button menu__wrapper__deletePlayer menu-player-color-' +
        player.color
      "
      *ngFor="let player of playerService.bindAllEntities() | async"
      (click)="deletePlayer(player.id)"
    >
      <i class="icon-bin2"></i>
      <span>{{ player.name }}</span>
    </button>
    <button
      class="menu__wrapper__button menu__wrapper__addPlayer"
      (click)="addPlayerClicked()"
      *ngIf="(playerService.bindList() | async).length < MAX_PLAYERS"
    >
      <i class="icon-plus"></i>
      <span>{{ "ADD_PLAYER" | translate }}</span>
    </button>

    <div class="menu__signature">
      <div class="menu__signature__label">{{ "SIGNATURE" | translate }}</div>
      <a
        class="menu__signature__link"
        href="https://victorjouin.com"
        target="_blank"
        >Victor Jouin</a
      >
    </div>
  </div>
</div>

<div
  class="menu__overlay"
  [ngClass]="{ active: menuOpen }"
  (click)="menuOpen = false"
></div>

<app-popin
  [(modal)]="resetPopin"
  [title]="'RESET_PROMPT' | translate"
  [buttons]="[
    { text: 'CANCEL' | translate, secondary: true },
    { text: 'RESET' | translate, danger: true }
  ]"
  (buttonPressed)="callbackReset($event)"
></app-popin>

<app-popin [(modal)]="settingsPopin" [title]="'SETTINGS' | translate">
  <div class="settings__setting">
    <div class="settings__label">{{ "TIMER" | translate }}</div>
    <div class="settings__content">
      <button
        class="settings__selectButton"
        [ngClass]="{
          'settings__selectButton--active':
            (timer$ | async)?.type === TimerType.OFF
        }"
        (click)="timerService.setType(TimerType.OFF)"
      >
        {{ "TIMER_OFF" | translate }}
      </button>
      <button
        class="settings__selectButton"
        [ngClass]="{
          'settings__selectButton--active':
            (timer$ | async)?.type === TimerType.BY_TURN
        }"
        (click)="timerService.setType(TimerType.BY_TURN)"
      >
        {{ "TIMER_BY_TURN" | translate }}
      </button>
      <button
        class="settings__selectButton"
        [ngClass]="{
          'settings__selectButton--active':
            (timer$ | async)?.type === TimerType.BY_PLAYER
        }"
        (click)="timerService.setType(TimerType.BY_PLAYER)"
      >
        {{ "TIMER_BY_PLAYER" | translate }}
      </button>
    </div>
  </div>
  <div
    class="settings__setting"
    *ngIf="(timer$ | async)?.type !== TimerType.OFF"
  >
    <div class="settings__label">
      {{
        ((timer$ | async)?.type === TimerType.BY_TURN
          ? "TIMER_BY_TURN_START"
          : "TIMER_BY_PLAYER_START"
        ) | translate
      }}
    </div>
    <div class="settings__content">
      <button
        class="settings__button"
        (click)="timerService.decrementStartValue()"
        [disabled]="(timer$ | async)?.startValue <= TIMER_SECONDS_INTERVAL * 10"
      >
        <i class="icon-minus-square"></i>
      </button>
      <div class="settings__value">
        {{ (timer$ | async)?.startValue | timer }}
      </div>
      <button
        class="settings__button"
        (click)="timerService.incrementStartValue()"
      >
        <i class="icon-plus-square"></i>
      </button>
    </div>
  </div>
  <ng-container *ngIf="(timer$ | async)?.type === TimerType.BY_PLAYER">
    <div class="settings__setting">
      <div class="settings__label">
        {{ "TIMER_BY_PLAYER_ADDITIONAL" | translate }}
      </div>
      <div class="settings__content">
        <button
          class="settings__button"
          (click)="timerService.decrementAdditionnalValue()"
          [disabled]="
            (timer$ | async)?.additionnalTime <= TIMER_SECONDS_INTERVAL * 10
          "
        >
          <i class="icon-minus-square"></i>
        </button>
        <div class="settings__value">
          {{ (timer$ | async)?.additionnalTime | timer }}
        </div>
        <button
          class="settings__button"
          (click)="timerService.incrementAdditionnalValue()"
        >
          <i class="icon-plus-square"></i>
        </button>
      </div>
    </div>
    <div class="settings__setting settings__tooltip">
      {{ "TIMER_BY_PLAYER_TOOLTIP" | translate }}
    </div>
    <div class="settings__setting">
      <div class="settings__label">
        {{ "TIMER_BY_PLAYER_BUFFER" | translate }}
      </div>
      <div class="settings__content">
        <button
          class="settings__button"
          (click)="timerService.decrementBufferValue()"
          [disabled]="(timer$ | async)?.bufferTime <= 0"
        >
          <i class="icon-minus-square"></i>
        </button>
        <div class="settings__value">
          {{ (timer$ | async)?.bufferTime | timer }}
        </div>
        <button
          class="settings__button"
          (click)="timerService.incrementBufferValue()"
        >
          <i class="icon-plus-square"></i>
        </button>
      </div>
    </div>
    <div class="settings__setting settings__tooltip">
      {{ "TIMER_BY_PLAYER_BUFFER_TOOLTIP" | translate }}
    </div>
  </ng-container>
</app-popin>
