<div #baseRef
  *ngIf="base"
  [class]="'base color-' + base.color"
  [ngClass]="{'detailsMode': detailsMode, 'editMode': editMode, 'conquered': base.resistance <= 0, 'dragging': dragging}"
  [ngStyle]="{'transform': getTransform(), 'left.%': coordinates[0], 'top.%': coordinates[1]}"
  (mousedown)="mouseDown($event)"
  (touchstart)="mouseDown($event)"
  (window:mousemove)="mouseMove($event)"
  (window:touchmove)="mouseMove($event)"
  (window:mouseup)="mouseUp()"
  (window:mouseleave)="mouseUp()"
  (window:touchend)="mouseUp()"
  (window:touchcancel)="mouseUp()"
  (click)="seeMoreDetails()">

  <div class="base__topPart">
    <div class="base__resistanceEdit" *ngIf="editMode">
      <span class="base__resistanceEdit__label">{{'BASE_RESISTANCE' | translate}}</span>
      <button class="base__resistanceEdit__button minus" [disabled]="base.maxResistance <= 0" (click)="decreaseResistance()"><i class="icon-minus-square"></i></button>
      <span class="base__resistanceEdit__value">{{base.maxResistance}}</span>
      <button class="base__resistanceEdit__button plus" [disabled]="base.maxResistance >= BASE_MAX_RESISTANCE" (click)="increaseResistance()"><i class="icon-plus-square"></i></button>
    </div>

    <div class="base__conquestAction" [ngClass]="{'forceConquest': base.resistance > 0, 'display': base.scores.length > 0}" *ngIf="!editMode && detailsMode">
      <button class="base__conquestAction__button" (click)="conquerBase()">
        <i class="icon-flag base__conquestAction__button__icon"></i>
        <span>{{(base.resistance <= 0 ? 'CONQUEST' : 'FORCE_CONQUEST') | translate}}</span>
      </button>
    </div>
  </div>

  <div class="base__card">
    <div class="base__card__addScoreList" *ngIf="!editMode && detailsMode">
      <ng-container *ngFor="let player of (playerService.bind() | async)">
        <button [class]="'base__card__addScoreList__button color-' + player.color" *ngIf="!getScore(player.id).score" (click)="addScore(player.id)"><i class="icon-eyedropper"></i></button>
      </ng-container>
    </div>

    <div class="base__card__actions" *ngIf="detailsMode">
      <button class="base__card__actions__button edit" (click)="editMode = !editMode"><i [class]="editMode ? 'icon-checkmark' : 'icon-pencil'"></i></button>
      <button class="base__card__actions__button delete" (click)="deleteBase()" *ngIf="editMode"><i class="icon-bin2"></i></button>
    </div>

    <ng-container *ngIf="!editMode">
      <div class="base__card__resistance">
        <span class="base__card__resistance__current">{{base.resistance}}</span>
        <span class="base__card__resistance__max" [ngClass]="{'displayed': base.resistance !== base.maxResistance}">/{{base.maxResistance}}</span>
      </div>
      <div class="base__card__resistance upsideDown">
        <span class="base__card__resistance__current">{{base.resistance}}</span>
        <span class="base__card__resistance__max" [ngClass]="{'displayed': base.resistance !== base.maxResistance}">/{{base.maxResistance}}</span>
      </div>
    </ng-container>

    <div class="base__card__rewards">
      <span class="base__card__rewards__reward" *ngFor="let reward of base.rewards; let i = index">
        {{reward}}
        <ng-container *ngIf="editMode">
          <button class="base__card__rewards__reward__button plus" [disabled]="reward >= BASE_REWARD_LIMITS[1]" (click)="increaseReward(i)"><i class="icon-plus-square"></i></button>
          <button class="base__card__rewards__reward__button minus" [disabled]="reward <= BASE_REWARD_LIMITS[0]" (click)="decreaseReward(i)"><i class="icon-minus-square"></i></button>
        </ng-container>
      </span>
    </div>
  </div>

  <div class="base__bottomPart">
    <div class="base__colorEdit" *ngIf="editMode">
      <button [class]="'base__colorEdit__color color-' + color" *ngFor="let color of (bindAvailableColors() | async)" (click)="chooseColor(color)"></button>
    </div>

    <div class="base__playerScores" *ngIf="!editMode && detailsMode">

      <div class="base__playerScores__list" *ngIf="base.scores.length > 0">
        <div [class]="'base__playerScores__list__score color-' + (playerService.bindPlayer(score.playerId) | async).color" *ngFor="let score of base.scores; let i = index" [ngClass]="{'modifierOpen': openedModifiers[i]}">
          <div class="base__playerScores__list__score__scoreAndButtons">
            <div class="base__playerScores__list__score__scoreAndButtons__score">{{score.score}}</div>
            <div class="base__playerScores__list__score__scoreAndButtons__buttons">
              <button class="base__playerScores__list__score__scoreAndButtons__buttons__button plus" (click)="increaseScore(i)"><i class="icon-plus-square"></i></button>
              <button class="base__playerScores__list__score__scoreAndButtons__buttons__button minus" [disabled]="score.score <= 0" (click)="decreaseScore(i)"><i class="icon-minus-square"></i></button>
            </div>
          </div>

          <div [class]="'base__playerScores__list__score__modifier color-' + (playerService.bindPlayer(score.playerId) | async).color" [ngClass]="{'zero': score.scoreModifier === 0}" (mouseleave)="modifierLeave(i)" (mouseenter)="modifierEnter(i)">
            <button class="base__playerScores__list__score__modifier__button plus" (click)="increaseScoreModifier(i)"><i class="icon-plus-square"></i></button>
            <div class="base__playerScores__list__score__modifier__value">{{score.scoreModifier > 0 ? '+' : ''}}{{score.scoreModifier}}</div>
            <button class="base__playerScores__list__score__modifier__button minus" (click)="decreaseScoreModifier(i)"><i class="icon-minus-square"></i></button>
          </div>

          <button class="base__playerScores__list__score__toggle" [disabled]="score.scoreModifier !== 0" (click)="openModifierClick(i)">
              {{'ON_TURN' | translate}}
          </button>
          <button class="base__playerScores__list__score__delete" (click)="deleteScore(i)"><i class="icon-blocked"></i></button>
          </div>
      </div>
    </div>

    <div class="base__playerScoresReduced" *ngIf="!editMode && !detailsMode">
      <div [class]="'base__playerScoresReduced__score color-' + (playerService.bindPlayer(score.playerId) | async).color" *ngFor="let score of base.scores; let i = index">
        {{score.totalScore}}
      </div>
    </div>
  </div>
</div>

<div class="base__backdrop" [ngClass]="{'visible': detailsMode}" (click)="exitMoreDetails()"></div>
